(function(a){var l={panels:[],panelCounter:0,postsData:{},allowPanelImageResize:!0,init:function(){"single"===ga_js_vars.page?this.initSingleAccordionPage():"all"===ga_js_vars.page&&this.initAllAccordionsPage()},initSingleAccordionPage:function(){var b=this;this.initPanels();-1!==parseInt(ga_js_vars.id,10)&&this.loadAccordionData();a("form").on("submit",function(a){a.preventDefault();b.saveAccordion()});a(".preview-accordion").on("click",function(a){a.preventDefault();b.previewAccordion()});a(".add-panel").on("click",
function(a){a.preventDefault();b.addImagePanels()});a(".postbox .hndle, .postbox .handlediv").on("click",function(){a(this).parent(".postbox").toggleClass("closed")});a(".sidebar-settings").on("mouseover","label",function(){b.showInfo(a(this))});a(window).resize(function(){!0===b.allowPanelImageResize&&(b.resizePanelImages(),b.allowPanelImageResize=!1,setTimeout(function(){b.resizePanelImages();b.allowPanelImageResize=!0},250))})},initAllAccordionsPage:function(){var b=this;a(".accordions-list").on("click",
".preview-accordion",function(c){c.preventDefault();b.previewAccordionAll(a(this))});a(".accordions-list").on("click",".delete-accordion",function(c){c.preventDefault();b.deleteAccordion(a(this))});a(".accordions-list").on("click",".duplicate-accordion",function(c){c.preventDefault();b.duplicateAccordion(a(this))});a(".clear-all-cache").on("click",function(c){c.preventDefault();a(".clear-cache-spinner").css("display","inline-block");c=a(this).attr("data-nonce");a.ajax({url:ga_js_vars.ajaxurl,type:"post",
data:{action:"grid_accordion_lite_clear_all_cache",nonce:c},complete:function(c){a(".clear-cache-spinner").css("display","")}})})},loadAccordionData:function(){var b=this;a(".panel-spinner").css("display","inline-block");a.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_lite_get_accordion_data",id:ga_js_vars.id,nonce:ga_js_vars.lad_nonce},complete:function(c){c=a.parseJSON(c.responseText);a.each(c.panels,function(c,e){var k={background:{},layers:e.layers,html:e.html,settings:a.isArray(e.settings)?
{}:e.settings};a.each(e,function(a,c){-1!==a.indexOf("background")&&(k.background[a]=c)});b.getPanel(c).setData("all",k)});a(".panel-spinner").css("display","")}})},saveAccordion:function(){var b=this.getAccordionData();b.nonce=ga_js_vars.sa_nonce;b.action="save";var b=JSON.stringify(b),c=a(".update-spinner").css("display","inline-block");a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_save_accordion",data:b},complete:function(b){c.css("display","");-1===parseInt(ga_js_vars.id,
10)&&!1===isNaN(b.responseText)?(a("h2").after('<div class="updated"><p>'+ga_js_vars.accordion_create+"</p></div>"),window.location=ga_js_vars.admin+"?page=grid-accordion-lite&id="+b.responseText+"&action=edit"):0===a(".updated").length&&a("h2").after('<div class="updated"><p>'+ga_js_vars.accordion_update+"</p></div>")}})},getAccordionData:function(){var b=this,c={id:ga_js_vars.id,name:a("input#title").val(),settings:{},panels:[],panels_state:{}};a(".panels-container").find(".panel").each(function(f){var e=
a(this),k=b.getPanel(parseInt(e.attr("data-id"),10)).getData("all");k.position=parseInt(e.attr("data-position"),10);c.panels[f]=k});a(".sidebar-settings").find(".setting").each(function(){var b=a(this);c.settings[b.attr("name")]="checkbox"===b.attr("type")?b.is(":checked"):b.val()});a(".sidebar-settings").find(".postbox").each(function(){var b=a(this);c.panels_state[b.attr("data-name")]=b.hasClass("closed")?"closed":""});return c},previewAccordion:function(){h.open(this.getAccordionData())},previewAccordionAll:function(b){var c=
a.lightURLParse(b.attr("href"));b=c.lad_nonce;c=parseInt(c.id,10);a.ajax({url:ga_js_vars.ajaxurl,type:"get",data:{action:"grid_accordion_lite_get_accordion_data",id:c,nonce:b},complete:function(b){b=a.parseJSON(b.responseText);h.open(b)}})},deleteAccordion:function(b){var c=a.lightURLParse(b.attr("href")),f=c.da_nonce,e=parseInt(c.id,10),k=b.parents("tr"),d=a('<div class="modal-overlay"></div><div class="modal-window-container">\t<div class="modal-window delete-accordion-dialog">\t\t<p class="dialog-question">'+
ga_js_vars.accordion_delete+'</p>\t\t<div class="dialog-buttons">\t\t\t<a class="button dialog-ok" href="#">'+ga_js_vars.yes+'</a>\t\t\t<a class="button dialog-cancel" href="#">'+ga_js_vars.cancel+"</a>\t\t</div>\t</div></div>").appendTo("body");a(".modal-window-container").css("top",a(window).scrollTop());d.find(".dialog-ok").one("click",function(b){b.preventDefault();a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_delete_accordion",id:e,nonce:f},complete:function(a){e===
parseInt(a.responseText,10)&&k.fadeOut(300,function(){k.remove()})}});d.remove()});d.find(".dialog-cancel").one("click",function(a){a.preventDefault();d.remove()});d.find(".modal-overlay").one("click",function(a){d.remove()})},duplicateAccordion:function(b){var c=a.lightURLParse(b.attr("href"));b=c.dua_nonce;c=parseInt(c.id,10);a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_duplicate_accordion",id:c,nonce:b},complete:function(b){a(b.responseText).appendTo(a(".accordions-list tbody")).hide().fadeIn()}})},
initPanels:function(){var b=this;a(".panels-container").find(".panel").each(function(c){b.initPanel(a(this))});a(".panels-container").lightSortable({children:".panel",placeholder:"panel panel-placeholder",sortEnd:function(b){a(".panel").each(function(b){a(this).attr("data-position",b)})}})},initPanel:function(a,c){var f=this,e=new d(a,this.panelCounter,c);this.panels.push(e);e.on("duplicatePanel",function(a){f.duplicatePanel(a.panelData)});e.on("deletePanel",function(a){f.deletePanel(a.id)});a.attr("data-id",
this.panelCounter);a.attr("data-position",this.panelCounter);this.panelCounter++},getPanel:function(b){var c;a.each(this.panels,function(a,e){if(e.id===b)return c=e,!1});return c},duplicatePanel:function(b){var c=this,f=a.extend(!0,{},b);a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_add_panels",data:JSON.stringify([{settings:{content_type:f.settings.content_type},background_source:f.background.background_source}])},complete:function(b){b=a(b.responseText).appendTo(a(".panels-container"));
c.initPanel(b,f)}})},deletePanel:function(b){var c=this,f=c.getPanel(b),e=a('<div class="modal-overlay"></div><div class="modal-window-container">\t<div class="modal-window delete-panel-dialog">\t\t<p class="dialog-question">'+ga_js_vars.panel_delete+'</p>\t\t<div class="dialog-buttons">\t\t\t<a class="button dialog-ok" href="#">'+ga_js_vars.yes+'</a>\t\t\t<a class="button dialog-cancel" href="#">'+ga_js_vars.cancel+"</a>\t\t</div>\t</div></div>").appendTo("body");a(".modal-window-container").css("top",
a(window).scrollTop());e.find(".dialog-ok").one("click",function(b){b.preventDefault();f.off("duplicatePanel");f.off("deletePanel");f.remove();e.remove();c.panels.splice(a.inArray(f,c.panels),1)});e.find(".dialog-cancel").one("click",function(a){a.preventDefault();e.remove()});e.find(".modal-overlay").one("click",function(a){e.remove()})},addImagePanels:function(){var b=this;g.open(function(c){var f=[];a.each(c,function(a,b){f.push({background_source:b.url,background_alt:b.alt,background_title:b.title,
background_width:b.width,background_height:b.height,background_link:b.link})});a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_add_panels",data:JSON.stringify(f)},complete:function(c){var d=a(".panels-container").find(".panel").length-1;a(".panels-container").append(c.responseText).find(".panel"+(-1===d?"":":gt("+d+")")).each(function(c){var d=a(this);b.initPanel(d,{background:f[c],layers:{},html:"",settings:{}})})}})})},showInfo:function(b){var c=b.attr("data-info"),
f=null;"undefined"!==typeof c&&(f=a('<div class="info-tooltip">'+c+"</div>").appendTo(b.parent()),f.css({left:-f.outerWidth(!0),marginTop:.5*-f.outerHeight(!0)-9}));b.on("mouseout",function(){null!==f&&f.remove()})},resizePanelImages:function(){var b=a(".panel-preview").width()/a(".panel-preview").height();a(".panel-preview > img").each(function(){var c=a(this);c.width()/c.height()>b?c.css({width:"auto",height:"100%"}):c.css({width:"100%",height:"auto"})})}},d=function(b,c,f){this.$panel=b;this.id=
c;this.data=f;this.events=a({});"undefined"===typeof this.data&&(this.data={background:{},layers:{},html:"",settings:{}});this.init()};d.prototype={init:function(){var a=this;this.$panel.find(".panel-preview").on("click",function(c){g.open(function(c){c=c[0];a.setData("background",{background_source:c.url,background_alt:c.alt,background_title:c.title,background_width:c.width,background_height:c.height,background_link:c.link});a.updatePanelPreview()})});this.$panel.find(".delete-panel").on("click",
function(c){c.preventDefault();a.trigger({type:"deletePanel",id:a.id})});this.$panel.find(".duplicate-panel").on("click",function(c){c.preventDefault();a.trigger({type:"duplicatePanel",panelData:a.data})});this.resizeImage()},getData:function(b){if("all"===b){var c={};a.each(this.data.background,function(a,b){c[a]=b});c.layers=this.data.layers;c.html=this.data.html;c.settings=this.data.settings;return c}if("background"===b)return this.data.background},setData:function(b,c){var d=this;"all"===b?this.data=
c:"background"===b&&a.each(c,function(a,b){d.data.background[a]=b})},remove:function(){this.$panel.find(".panel-preview").off("click");this.$panel.find(".delete-panel").off("click");this.$panel.find(".duplicate-panel").off("click");this.$panel.fadeOut(500,function(){a(this).remove()})},updatePanelPreview:function(){var b=this.$panel.find(".panel-preview"),c=this.data.settings.content_type;b.empty();if("undefined"===typeof c||"custom"===c)c=this.data.background.background_source,"undefined"!==typeof c&&
""!==c?(a('<img src="'+c+'" />').appendTo(b),this.resizeImage()):a('<p class="no-image">'+ga_js_vars.no_image+"</p>").appendTo(b),this.$panel.removeClass("dynamic-panel")},resizeImage:function(){var a=this.$panel.find(".panel-preview"),c=this.$panel.find(".panel-preview > img");if(c.length)var d=setInterval(function(){!0===c[0].complete&&(clearInterval(d),c.width()/c.height()>a.width()/a.height()?c.css({width:"auto",height:"100%"}):c.css({width:"100%",height:"auto"}))},100)},on:function(a,c){this.events.on(a,
c)},off:function(a){this.events.off(a)},trigger:function(a){this.events.triggerHandler(a)}};var g={open:function(a){var c=[],d=wp.media.editor.insert;wp.media.editor.send.attachment=function(a,b){var d="undefined"!==typeof b.sizes[a.size]?b.sizes[a.size]:b.sizes.full;c.push({url:d.url,alt:b.alt,title:b.title,width:d.width,height:d.height,link:"custom"===a.link?a.linkUrl:""})};wp.media.editor.insert=function(e){a.call(this,c);wp.media.editor.insert=d};wp.media.editor.open("media-loader")}},h={previewWindow:null,
accordion:null,accordionData:null,open:function(b){this.accordionData=b;var c=this,d=a(".preview-spinner").css("display","inline-block");a.ajax({url:ga_js_vars.ajaxurl,type:"post",data:{action:"grid_accordion_lite_preview_accordion",data:JSON.stringify(b)},complete:function(b){a("body").append(b.responseText);c.init();d.css("display","")}})},init:function(){var b=this;a(".modal-window-container").css("top",a(window).scrollTop());this.previewWindow=a(".preview-window .modal-window");this.accordion=
this.previewWindow.find(".grid-accordion");this.previewWindow.find(".close-x").on("click",function(a){b.close()});var c=this.accordionData.settings.width,d=this.accordionData.settings.height,e=-1!==c.indexOf("%"),h=-1!==d.indexOf("%");!0===e?this.accordion.gridAccordion("width","100%"):c=parseInt(c,10);!0===h&&this.accordion.gridAccordion("height","100%");a(window).on("resize.gridAccordion",function(){!0===e?b.previewWindow.css("width",a(window).width()*(parseInt(c,10)/100)-100):c>=a(window).width()-
100?b.previewWindow.css("width",a(window).width()-100):b.previewWindow.css("width",c);!0===h&&b.previewWindow.css("height",a(window).height()*(parseInt(d,10)/100)-200)});a(window).trigger("resize");a(window).trigger("resize")},close:function(){this.previewWindow.find(".close-x").off("click");a(window).off("resize.gridAccordion");this.accordion.gridAccordion("destroy");a("body").find(".modal-overlay, .modal-window-container").remove()}};a(document).ready(function(){l.init()})})(jQuery);
(function(a){var l=function(d,g){this.options=g;this.$container=a(d);this.$placeholder=this.$selectedChild=null;this.initialMouseY=this.initialMouseX=this.panelInitialY=this.panelInitialX=this.currentMouseY=this.currentMouseX=0;this.isDragging=!1;this.checkHover=0;this.uid=(new Date).valueOf();this.events=a({});this.endPosition=this.startPosition=0;this.init()};l.prototype={init:function(){this.settings=a.extend({},this.defaults,this.options);this.$container.on("mousedown.lightSortable"+this.uid,
a.proxy(this._onDragStart,this));a(document).on("mousemove.lightSortable."+this.uid,a.proxy(this._onDragging,this));a(document).on("mouseup.lightSortable."+this.uid,a.proxy(this._onDragEnd,this))},_onDragStart:function(d){1!==d.which||a(d.target).is("select")||a(d.target).is("input")||(this.$selectedChild=a(d.target).is(this.settings.children)?a(d.target):a(d.target).parents(this.settings.children),1===this.$selectedChild.length&&(this.initialMouseX=d.pageX,this.initialMouseY=d.pageY,this.panelInitialX=
this.$selectedChild.position().left,this.panelInitialY=this.$selectedChild.position().top,this.startPosition=this.$selectedChild.index(),d.preventDefault()))},_onDragging:function(d){if(null!==this.$selectedChild&&0!==this.$selectedChild.length){d.preventDefault();this.currentMouseX=d.pageX;this.currentMouseY=d.pageY;if(!this.isDragging){this.isDragging=!0;this.trigger({type:"sortStart"});a.isFunction(this.settings.sortStart)&&this.settings.sortStart.call(this,{type:"sortStart"});d=this.$container.is("ul")||
this.$container.is("ol")?"li":"div";this.$placeholder=a("<"+d+">").addClass("ls-ignore "+this.settings.placeholder).insertAfter(this.$selectedChild);0===this.$placeholder.width()&&this.$placeholder.css("width",this.$selectedChild.outerWidth());0===this.$placeholder.height()&&this.$placeholder.css("height",this.$selectedChild.outerHeight());this.$selectedChild.css({"pointer-events":"none",position:"absolute",left:this.$selectedChild.position().left,top:this.$selectedChild.position().top,width:this.$selectedChild.width(),
height:this.$selectedChild.height()}).addClass("ls-ignore");this.$container.append(this.$selectedChild);a("body").css("user-select","none");var g=this;this.checkHover=setInterval(function(){g.$container.find(g.settings.children).not(".ls-ignore").each(function(){var d=a(this);g.currentMouseX>d.offset().left&&g.currentMouseX<d.offset().left+d.width()&&g.currentMouseY>d.offset().top&&g.currentMouseY<d.offset().top+d.height()&&(d.index()>=g.$placeholder.index()?g.$placeholder.insertAfter(d):g.$placeholder.insertBefore(d))})},
200)}this.$selectedChild.css({left:this.currentMouseX-this.initialMouseX+this.panelInitialX,top:this.currentMouseY-this.initialMouseY+this.panelInitialY})}},_onDragEnd:function(){this.isDragging&&(this.isDragging=!1,a("body").css("user-select",""),this.$selectedChild.css({position:"",left:"",top:"",width:"",height:"","pointer-events":""}).removeClass("ls-ignore").insertAfter(this.$placeholder),this.$placeholder.remove(),clearInterval(this.checkHover),this.endPosition=this.$selectedChild.index(),this.trigger({type:"sortEnd"}),
a.isFunction(this.settings.sortEnd)&&this.settings.sortEnd.call(this,{type:"sortEnd",startPosition:this.startPosition,endPosition:this.endPosition}));this.$selectedChild=null},destroy:function(){this.$container.removeData("lightSortable");this.isDragging&&this._onDragEnd();this.$container.off("mousedown.lightSortable."+this.uid);a(document).off("mousemove.lightSortable."+this.uid);a(document).off("mouseup.lightSortable."+this.uid)},on:function(a,g){return this.events.on(a,g)},off:function(a){return this.events.off(a)},
trigger:function(a){return this.events.triggerHandler(a)},defaults:{placeholder:"",sortStart:function(){},sortEnd:function(){}}};a.fn.lightSortable=function(d){var g=Array.prototype.slice.call(arguments,1);return this.each(function(){if("undefined"===typeof a(this).data("lightSortable")){var h=new l(this,d);a(this).data("lightSortable",h)}else"undefined"!==typeof d&&(h=a(this).data("lightSortable"),"function"===typeof h[d]?h[d].apply(h,g):a.error(d+" does not exist in lightSortable."))})}})(jQuery);
(function(a){a.lightURLParse=function(l){l=l.split("?")[1].split("&");var d=[];a.each(l,function(a,h){var b=h.split("=");d[b[0]]=b[1]});return d}})(jQuery);